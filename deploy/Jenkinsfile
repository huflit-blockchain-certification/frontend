pipeline {
    agent any
    stages {
        stage('docker build/push'){
             docker.withRegistry('https://index.docker.io/v2/', 'dockerhub') {
                def app = docker.build("ngocphupham/todolist:${commit_id}", '.').push()
             }
        }
        stage('Deploy') {
            steps {
                sshagent(['vinhphan-root-keys']) {
                    sh '''
                        ssh root@194.163.180.21 "
                        cd /home/blockchain/frontend &&
                        git pull &&
                        docker-compose up -d --build
                        "
                    '''
                }
            }
        }
    }
}
